jQuery(document).ready(function(a){var b=wc_ps_vars.legacy_api_url,c=wc_ps_vars.permalink_structure,d=wc_ps_vars.search_page_url,e=wc_ps_vars.minChars,f=wc_ps_vars.delay,g={apps:{},models:{},collections:{},views:{}};_.templateSettings={evaluate:/\{\{(.+?)\}\}/g,interpolate:/\{\{=(.+?)\}\}/g,escape:/\{\{-(.+?)\}\}/g},g.models.Item=Backbone.Model.extend({defaults:{title:"Empty Product",keyword:"",url:null,image_url:null,sku:null,price:null,description:null,type:"product",status:!0}}),g.collections.Items=Backbone.Collection.extend({model:g.models.Item,totalItems:function(){return this.where({status:!0}).length},haveItems:function(a){return this.where({type:a}).length}}),g.views.Item=Backbone.View.extend({tagName:"li",className:function(){return"ac_odd"},itemTpl:_.template(a("#wc_psearch_itemTpl").html()),footerTpl:_.template(a("#wc_psearch_footerTpl").html()),initialize:function(){this.listenTo(this.model,"destroy",this.remove)},render:function(){switch(this.model.get("type")){case"header":console.log("Predictive Search Popup - Rendering "+this.model.get("title")+" header"),this.$el.html('<div class="ajax_search_content_title">'+this.model.get("title")+"</div>");break;case"footer":console.log("Predictive Search Popup - Rendering footer"),this.$el.html(this.footerTpl(this.model.toJSON()));break;case"nothing":console.log("Predictive Search Popup - Rendering nothing"),this.$el.html('<div class="ajax_no_result">'+this.model.get("title")+"</div>");break;default:console.log("Predictive Search Popup - Rendering item "+this.model.get("title")),this.$el.html(this.itemTpl(this.model.toJSON()))}return this}}),g.views.PopupResult=Backbone.View.extend({initialize:function(){console.log("Predictive Search Popup - init"),this.predictive_search_input=null,this.original_ps_search_other="",this.listenTo(this.collection,"add",this.addItem),this.list_items_container=this.$(".predictive_search_results")},createItems:function(b){a.each(b,function(a,b){this.collection.add(b)}.bind(this)),""==this.original_ps_search_other&&(this.original_ps_search_other=a(this.predictive_search_input).data("ps-search_other")),""==this.original_ps_search_in&&(this.original_ps_search_in=a(this.predictive_search_input).data("ps-search_in")),ps_search_other=this.original_ps_search_other.split(","),ps_id=a(this.predictive_search_input).data("ps-id"),new_ps_search_other=[],new_ps_search_in="",a.each(ps_search_other,function(a,b){this.collection.haveItems(b)>0&&(new_ps_search_other.push(b),""==new_ps_search_in&&(new_ps_search_in=b))}.bind(this)),""!=new_ps_search_in&&(a(this.predictive_search_input).data("ps-search_in",new_ps_search_in),a("#fr_pp_search_widget_"+ps_id).find("input[name=search_in]").val(new_ps_search_in)),0==new_ps_search_other.length&&(new_ps_search_other=[a(this.predictive_search_input).data("ps-search_in")]),a(this.predictive_search_input).data("ps-search_other",new_ps_search_other.join(",")),a("#fr_pp_search_widget_"+ps_id).find("input[name=search_other]").val(new_ps_search_other.join(","))},addItem:function(b){console.log("Predictive Search Popup - Added item "+b.get("title"));var c=new g.views.Item({model:b}),d=c.render().el;this.list_items_container.append(d),a.data(d,"ac_data",b.attributes)},clearAll:function(){return _.invoke(this.collection.where({status:!0}),"destroy"),!1}}),g.apps.App={initialize:function(){a(document).on("click",".predictive_search_bt",this.goToSearchResultPage),a(".fr_search_widget").bind("keypress",function(a){return 13==a.keyCode?(this.goToSearchResultPage(a),!1):void 0}.bind(this)),this.initPredictSearch()},initPredictSearch:function(){a(".predictive_search_input").each(function(){a(this).autocomplete(b,{minChars:e,delay:f,scrollHeight:2e3,loadingClass:"predictive_loading",highlight:!1},g),a(this).result(function(b,c,d){""!=c&&a(this).val(c),""!=d&&null!=d&&"#"!=d&&(window.location=d)})})},goToSearchResultPage:function(b){var e=a(b.target);ps_id=e.data("ps-id"),predictive_search_input=a("#pp_course_"+ps_id),""!=predictive_search_input.val()&&predictive_search_input.val()!=predictive_search_input.data("ps-default_text")&&(""==c?a("#fr_pp_search_widget_"+ps_id).submit():(ps_keyword=predictive_search_input.val(),ps_search_in=predictive_search_input.data("ps-search_in"),ps_search_other=predictive_search_input.data("ps-search_other"),ps_pcat=predictive_search_input.data("ps-pcat"),ps_ptag=predictive_search_input.data("ps-ptag"),ps_scat=predictive_search_input.data("ps-scat"),ps_stag=predictive_search_input.data("ps-stag"),pp_search_url=d+"/keyword/"+ps_keyword.replace("(","%28").replace(")","%29")+"/search-in/"+ps_search_in,"undefined"!=typeof ps_pcat&&""!=ps_pcat?pp_search_url+="/pcat/"+ps_pcat:"undefined"!=typeof ps_ptag&&""!=ps_ptag?pp_search_url+="/ptag/"+ps_ptag:"undefined"!=typeof ps_scat&&""!=ps_scat?pp_search_url+="/scat/"+ps_scat:"undefined"!=typeof ps_stag&&""!=ps_stag&&(pp_search_url+="/stag/"+ps_stag),pp_search_url+="/search-other/"+ps_search_other,window.location=pp_search_url))}};var h=g.apps.App;h.initialize()});